// ==UserScript==
// @name         æ–—é±¼è‡ªç”¨å¼¹å¹•è„šæœ¬
// @namespace    https://greasyfork.org/zh-CN/scripts/
// @version      0.9.0
// @description  æœ¬è„šæœ¬åŒ…å«ä¸»è¦åŠŸèƒ½ï¼šæ–—é±¼è‡ªåŠ¨ç«åŠ›å…¨å¼€æœå¯»+è‡ªåŠ¨å‘é€æŠ¢é±¼ä¸¸çº¢åŒ…çš„å¼¹å¹•+çš‡å¸å¼¹å¹•ç‰¹æ•ˆ(æœ¬æœº)+ä¸ç»‘å®šæ‰‹æœºå·å‘å¼¹å¹•+æˆ¿é—´è‡ªåŠ¨ç­¾åˆ°+æˆ¿é—´åœ¨çº¿äººæ•°+ä¸»æ’­å¼€æ’­æ—¶é—´ç´¯ç§¯+ä»Šæ—¥è·³è½¬æ¬¡æ•°+ä¸»æ’­ä¿¡ç”¨å€¼+ç”»è´¨è°ƒæ•´(ç”¨æˆ·è‡ªè¡Œå¼€å¯)+æ˜¯å¦è‡ªåŠ¨æ’­æ”¾(ç”¨æˆ·è‡ªè¡Œå¼€å¯)+å…³é—­æ»šå±å¼¹å¹•(ç”¨æˆ·è‡ªè¡Œå¼€å¯)ç­‰åŠŸèƒ½ && Main Function of Scriptï¼šAuto Fire Power Seek + Auto Barrage Bombing + Royal Barrage Effect + Sent Barrage Without Binding Phone + Room Assign + Real People number + Jumping Page Times + Host Credit and so forth;
// @author       lvlanxing
// @supportURL   https://github.com/wolf-scream/
// @icon         http://www.douyutv.com/favicon.ico
// @include      https://www.douyu.com/0*
// @include      https://www.douyu.com/1*
// @include      https://www.douyu.com/2*
// @include      https://www.douyu.com/3*
// @include      https://www.douyu.com/4*
// @include      https://www.douyu.com/5*
// @include      https://www.douyu.com/6*
// @include      https://www.douyu.com/7*
// @include      https://www.douyu.com/8*
// @include      https://www.douyu.com/9*
// @include      https://www.douyu.com/topic/*
// @include      https://www.douyu.com/*?rid=*
// @mail         lvlanxing@gmail.com
// @copyright    JadeBone
// @grant        none
// @license      GPL-3.0
// @run-at       document-end
// @compatible   chrome
// ==/UserScript==


(function() {

    //ç«åŠ›è‡ªåŠ¨ç›‘å¬å¼¹å¹•
    var arrCommon = ["ä¸»æ’­åŠ æ²¹ğŸ’ª","666ğŸ¤˜ğŸ¤˜ğŸ¤˜","ç‚¹å‡»å…³æ³¨ï¼Œä¸ä¼šè¿·è·¯","å¼¹å¹•ğŸ¤å†²é¸­ğŸ¤å†²é¸­ğŸ¤","æˆ‘æ¥å†’ä¸ªæ³¡ï¼ŒğŸ§æ†¨æ†¨","ç«åŠ›å…¨å¼€æš´èºèµ·æ¥","å°ç¤¼ç‰©ğŸåˆ·èµ·æ¥","ä¸€å‘å…¥é­‚å“ˆğŸ”«ï¼Œæ†¨æ†¨","ä¸ºäº†ä¸»æ’­çš„çƒ­åº¦ï¼Œæ‹¼äº†ä¹Ÿè¦æŠŠé”®ç›˜æ•²ä¸ªç¨€å·´çƒ‚ï¼",
                     "å¯ä»¥å¤¸ä¸‹ğŸ·æ’­ï¼Œä½†æ‡’å¾—æ‰“å­—","ç¥å¥‡çš„ä¸»æ’­ï¼Œä¼˜è´¨çš„å¼¹å¹•","æ°´å†›æ¥æ§ï¼Œä¸»æ’­å¨çŒ›ï¼›é“ç²‰é©¾åˆ°ï¼Œçƒ­åº¦å¿…çˆ†","è‡ªå®¶äººï¼Œåˆ«è¯¯ä¼¤","å¹»ç¥ä¹‹å¤§èˆ…å“¥ï¼Œæ¥ä¸ºä¸»æ’­åŠ æ²¹åŠ©å¨ğŸš€*10ï¼",
                     "ğŸ›¸*1000 ç¥ä¸»æ’­è¶Šæ¥è¶Šçº¢ï¼Œè¶Šæ¥è¶Šç«ï¼Œè¶Šæ¥è¶Šå¯Œï¼Œè¶Šæ¥è¶Šå¼ºğŸ‘ï¼","à¸à¸´à¸´à¸´à¸´à¸´è§à¸à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´å…‰à¸à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´æ£’à¸à¸´à¸´à¸´à¸´à¸´","æ¥ä¸ªåŠå¡ğŸ’³*999"];

    var arrPoetry = ["å’¸é˜³å¤é“éŸ³å°˜çŸ­ï¼Œæ–—é±¼æˆ¿é—´å¼¹å¹•é•¿ï¼", "å®‰èƒ½æ‘§çœ‰æŠ˜è…°äº‹æƒè´µï¼Œçš‡å›½å…¬ä¼¯å­éª‘çš†å¤§ä½¬ï¼","è¡£å¸¦æ¸å®½ç»ˆä¸æ‚”ï¼Œé±¼ä¸¸è¾“çš„äººæ†”æ‚´","æ–—é±¼ä¸å€’ï¼Œé™ªä½ åˆ°è€ï¼Œç½‘ç»œä¸æ–­ï¼Œä¸ä½ ç›¸ä¼´ï¼",
                     "æŠ½åˆ€æ–­æ°´æ°´æ›´æµï¼Œç«åŠ›è½°è¶´è¶´æ›´ä¹…ï¼", "å¤§é£èµ·å…®äº‘é£æ‰¬ï¼Œå¼¹å¹•å†²å…®äººæ»¡æˆ¿ï¼", "é’Ÿé¼“é¦”ç‰ä¸è¶³è´µï¼Œç¦è¢‹åŠå¡ä¸å«Œå¤šï¼","åƒå‘¼ä¸‡å”¤ç«åŠ›å¼€ï¼Œå¾…åˆ°å¼€å¥–æ— ç¼˜æ‘˜ï¼",
                     "æ¬²æ¸¡é»„æ²³å†°å¡å·ï¼Œå¼¹å¹•ç•™è¨€å †æ»¡å±±ï¼","å±±é‡æ°´å¤ç–‘æ— è·¯ï¼Œå…³æ³¨ä¸»æ’­ä¸è¿·è·¯ï¼","é»„äº‘ä¸‡é‡ŒåŠ¨é£è‰²ï¼Œé±¼å¡˜ç™¾äº©æ— é£èˆ¹ï¼", "é‡‘æ¨½æ¸…é…’æ–—ååƒï¼ŒğŸš€ç«ç®­é£èˆ¹ç›´ä¸‡é’±ï¼",
                     "å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œé±¼ç¿…æ•£å°½æŠŠå®¶è¿˜ï¼","äººç”Ÿå¾—æ„é¡»å°½æ¬¢ï¼Œç¦è¢‹åŠå¡åˆ·æ»¡å¤©ï¼","åˆ«æœ‰å¹½æ„æš—æ¨ç”Ÿï¼Œæ­¤åˆ»åˆ·ç¤¼ä¸åšå£°ï¼","è‹Ÿåˆ©ä¸»æ’­çƒ­åº¦çŸ£ï¼Œå²‚å› ç¤¼å°è€Œä¸èµ ï¼",
                     "é»‘äº‘å‹åŸåŸæ¬²æ‘§ï¼Œä¸»æ’­å¼€è½¦æˆ‘æ¥é»‘ï¼","èŠ±è°¢èŠ±é£èŠ±æ»¡å¤©ï¼Œé±¼ä¸¸è¾“å…‰æœ‰è°æ€œï¼","çœŸæ­£çš„ä¸»æ’­ï¼Œæ•¢äºç›´é¢æ°´å‹çš„æ€’å–·ï¼Œæ•¢äºæ­£è§†åŒè¡Œçš„è…¹é»‘ï¼",
                     "é’±å…¥é±¼å¡˜ï¼Œä¸‰åˆ†çº¢ç„–é±¼ç¿…ï¼Œä¸ƒåˆ†æ°´ç…®é±¼ä¸¸ï¼Œå¤§é”…ä¸€é¡¿ï¼Œå°±æ˜¯ä¸€é”…é±¼æ±¤ï¼","é“è·¯åƒä¸‡æ¡ï¼Œå…³æ³¨ç¬¬ä¸€æ¡ï¼Œæ–‡æ˜åˆ·å¼¹å¹•ï¼Œè¿œç¦»å°é»‘å±‹ï¼",
                     "é£å£°é›¨å£°è¯»ä¹¦å£°å£°å£°å…¥è€³ï¼Œå­çˆµä¼¯çˆµå…¬çˆµçˆµçˆµé«˜è´µï¼","è¸ç ´é“é‹æ— è§…å¤„ï¼Œä¸­å¥–æåº¦è´¹å·¥å¤«ï¼","æµ·é˜”å‡­é±¼è·ƒï¼Œå¼¹å¹•æ»¡å±é£ï¼","æœˆä¸‹å¼¹å¹•åˆ·æ»¡å¤©ï¼Œæˆ¿å†…ç«çƒ­æ­£å…´é…£ï¼",
                     "åƒç£¨ä¸‡å‡»è¿˜åšéŸ§ï¼Œä»»å°”æ¥é»‘ä»»ä½ å–·ï¼","è¿ç­¹å¸·å¹„ä¸­ï¼Œä¸»å®°PKä¹‹èƒœï¼","é£è§è§å…®æ˜“æ°´å¯’ï¼Œé±¼ä¸¸ä¸€å»å…®ä¸å¤è¿˜ï¼","ä¸´æ¸Šç¾¡é±¼ï¼Œä¸å¦‚é€€è€Œä¹°é±¼ç¿…ï¼",
                     "æµ·çº³ç™¾å·ï¼Œæœ‰å®¹ä¹ƒå¤§ï¼Œä¸»æ’­PKï¼Œæ²¡ç²‰å¿…è¾“ï¼","å±±æ— æ£±ï¼Œé±¼å¡˜ä¸ºç«­ï¼Œå¼¹å¹•çº·çº·ï¼Œçƒ­åº¦ç«ï¼Œåˆ·å®Œç¤¼ï¼Œä¹ƒæ•¢å…³ç›´æ’­ï¼","èº«æ— å½©å‡¤åˆ·ç¤¼ç‰©ï¼Œå¿ƒæœ‰çµçŠ€ç‚¹å…³æ³¨ï¼",
                     "ä¼—é‡Œå¯»ä½ åƒç™¾åº¦ï¼Œè“¦ç„¶å›é¦–ï¼Œä¸»æ’­å´åœ¨ï¼Œå¼¹å¹•çº·é£æ‰å †å¤„ï¼","å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ï¼Œçº¢åŒ…é±¼ç¿…ï¼Œå›å­å¥½é€‘ï¼","æ¥çš„æ½‡æ´’èµ°å¾—é…·ï¼Œç‚¹ç‚¹å…³æ³¨ä¸è¿·è·¯ï¼Œä¸»æ’­å¸¦ä½ ä¸Šé«˜é€Ÿ",
                     "å¿ƒæœ‰çŒ›è™ï¼Œç»†å—…è”·è–‡ã€‚åˆ·ç¤¼ä¹‹åï¼Œå¼€å¿ƒä¸€ç¬‘ï¼","å¼¹å¹•ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»Šå¤©é‡åˆ°çš„éƒ½æ˜¯æœ‰ä¿®å…»çš„äººï¼","å‹æƒ…æ˜¯ç§¯ç´¯çš„ï¼Œçˆ±æƒ…æ˜¯çªç„¶çš„ï¼›çƒ­åº¦æ˜¯ç§¯ç´¯çš„ï¼Œç¤¼ç‰©æ˜¯çªç„¶çš„ï¼",
                     "å²æœˆæ‚ é•¿ï¼Œå±±æ²³æ— æ™ï¼Œå…³æ³¨ä¸»æ’­ï¼Œç“œåˆ†å®è—","æ–—é±¼ä¸­æ³¨å®šä¼šé‡åˆ°ä¸¤ç±»ä¸»æ’­ï¼Œä¸€ç±»æƒŠè‰³äº†æ—¶å…‰ï¼Œä¸€ç±»æ¸©æŸ”äº†å²æœˆï¼","è¾›è¾›è‹¦è‹¦å‡ åå¹´ï¼Œä¸€è¾“å›åˆ°è§£æ”¾å‰ï¼",
                     "å§‹äºåˆè§ä¸»æ’­ç›¸æ¿¡ä»¥æ²«ï¼Œæ­¢äºåœæ’­è½å¹•ç›¸å¿˜äºæ±Ÿæ¹–ï¼","ä¸–ä¸Šæœ€é¥è¿œçš„è·ç¦»,ä¸æ˜¯ç”Ÿä¸æ­»çš„è·ç¦»,è€Œæ˜¯æˆ‘å°±åœ¨å±å¹•å‰ï¼Œä½ å´çœ‹ä¸åˆ°æˆ‘ï¼",
                     "é£æœºè¯šå¯è´µï¼Œç«ç®­ä»·æ›´é«˜ï¼Œè‹¥ä¸ºä¸»æ’­æ•…ï¼ŒäºŒè€…çš†å¯æŠ›!","äººç”Ÿæœ‰ä¸¤ç§å¢ƒç•Œï¼Œç—›è€Œä¸è¨€ï¼Œç¬‘è€Œä¸è¯­ï¼›æ–—é±¼æœ‰ä¸¤ç±»ä¸»æ’­ï¼Œä¸€ç±»é é¢œå€¼è„±é¢–ï¼Œä¸€ç±»æ‹¼æ‰è‰ºå‡ºå½©ï¼Œæ­¤ä¸»æ’­å´ä¸¤æ ·å…¨å ï¼",
                     "åå¹´ä¿®å¾—åŒèˆ¹æ¸¡ï¼Œå¤§å®¶ä¸€èµ·ç‚¹å…³æ³¨ï¼›ç™¾å¹´ä¿®å¾—å…±æ•çœ ï¼Œåˆ·åˆ·é±¼ä¸¸ä¸è¦é’±ï¼","å†ä¸å¼€ç«å°±æ²¡ä¸¸å­äº†ï¼Œå¼€ç«è¿‡åä¼šå‘ç°ï¼Œè¿˜æ˜¯æ²¡å¾—åˆ°ä¸¸å­ï¼","ä¸»æ’­çš„ä¸»è¦æˆåˆ†ï¼š1%çš„å®åŠ›+99%çš„æ°´åˆ†",
                     "ç»™ç«çŒœä¸»æ’­å¤šå¤§çš„èˆå°ï¼Œä»–å°±èƒ½è®©æˆ‘ä»¬è¾“çš„æœ‰å¤šæƒ¨ï¼","åƒä¸»æ’­è¿™ç§äººé™¤äº†é¢œå€¼é«˜ï¼Œå…¶ä»–æ²¡ä»€ä¹ˆå¥½å¤¸çš„ï¼","ç”Ÿæ´»ä¸æ­¢çœ¼å‰çš„è‹Ÿä¸”ï¼Œè¿˜æœ‰æ°´ç”µè´¹å’Œé±¼ç¿…è´¹ï¼",
                     "ç¿»è¿‡é«˜å±±ï¼Œæ­£é‡æ±Ÿæ²³ã€‚è¡Œè¿‡é›ªåŸï¼Œæ°é€¢èŠ±å‹ƒã€‚è¿›å…¥æ–—é±¼ï¼Œå·§é‡ä¸»æ’­ï¼","ä¸è½»æ˜“è¯„ä»·ä¸»æ’­æ˜¯ä¸€ç§ä¿®å…»ï¼›ä¸æ´»åœ¨åˆ«äººçš„è¯„ä»·é‡Œæ˜¯ä¸€ç§æ™ºæ…§ï¼",
                     "æ°´å‹å²‚æ˜¯æ± ä¸­ç‰©ï¼Œä¸€é‡ä¸»æ’­è¢«æç©ºï¼","è¿·æ‹ä¸€æœµèŠ±ï¼Œä¸ä¸€å®šè¦æŠŠå®ƒæ‘˜ä¸‹ï¼›å–œæ¬¢ä¸€ä¸ªä¸»æ’­ï¼Œä¸ä¸€å®šè¦æŠŠç¤¼ç‰©åˆ·çˆ†ï¼",
                     "ä¸»æ’­å¹´é¾„è¿‡ä¸äº†å„¿ç«¥èŠ‚ï¼Œä½†æ™ºå•†ç»å¯¹ç»°ç»°æœ‰ä½™ï¼","ä¸»æ’­æ€»æ˜¯éª—æˆ‘ä»¬è¿™äº›å°ç™½ï¼Œè€Œä»æ¥ä¸ä¼šèƒŒå›ä¸æ¬ºéª—çš„äº‹ï¼Œè«è¿‡äºåƒè‚‰ï¼Œåƒä¸€æ–¤ï¼Œé•¿ä¸€æ–¤ï¼Œæ°¸è¿œçœŸè¯šç›¸å¾…",
                     "æ„¿ä½ ç†¬å¾—è¿‡ä¸‡ä¸ˆå­¤ç‹¬ï¼Œè—å¾—ä¸‹æ˜Ÿè¾°å¤§æµ·ï¼Œæœ€ç»ˆå¾—åˆ°ä¸»æ’­çš„å‚é’ï¼","å¯¡äººæ¯å¤©éƒ½å¤„åœ¨å¿ƒæœ‰ä½™è€Œç¡çœ ä¸è¶³ï¼Œå¿ƒæœ‰ä½™è€Œæ™ºå•†ä¸è¶³ï¼Œå¿ƒæœ‰ä½™è€Œé±¼ç¿…ä¸è¶³çš„çŠ¶æ€ï¼",
                     "ä»–æ¥äº†ï¼Œä»–æ¥äº†ï¼Œä»–å¸¦ç€é±¼ç¿…æ¥ç©äº†ï¼›æˆ‘æ¥äº†ï¼Œæˆ‘æ¥äº†ï¼Œæˆ‘ä¸¤æ‰‹ç©ºç©ºæ¥æŠ¢ä¸¸å­ï¼","å¦‚æœä½ å¤©å¤©çœ‹æ–—é±¼è€Œæ²¡æ—¶é—´æ—…æ¸¸ï¼Œé‚£å°±ä¹°ä¸ªåœ°çƒä»ªå§ï¼Œä¸–ç•Œé‚£ä¹ˆå¤§ï¼Œä½ ä¸ä½†å¯ä»¥çœ‹çœ‹è¿˜å¯ä»¥è½¬è½¬ï¼",
                     "ä»¥å‰ä¸»æ’­å–œæ¬¢ä¸€ä¸ªäººï¼Œç°åœ¨ä¸»æ’­å–œæ¬¢ä¸€ä¸ªäºº","ä¸»æ’­å†…å®¹ä¸èƒ½åå…¨åç¾ï¼Œä½†ä¸€å®šå¯ä»¥ç‹¬ä¸€æ— äºŒï¼","å¼¹å¹•å†²å…®æ°”ç›–ä¸–ï¼Œæ—¶ä¸åˆ©å…®é±¼ä¸¸é€ï¼Œé±¼ä¸¸é€å…®å¯å¥ˆä½•ï¼Œé±¼ç¿…é±¼ç¿…å¥ˆè‹¥ä½•ï¼",
                     "ç§‹é£èµ·å…®ç™½äº‘é£ï¼Œè‰æœ¨é»„å…®é›å—å½’ï¼Œå¼¹å¹•å†²å…®çƒ­åº¦çˆ†ï¼Œç¤¼ç‰©é£å…®ä¸»æ’­ç¬‘!","å¯¹é…’å½“æ­Œï¼Œäººç”Ÿå‡ ä½•ï¼Œå…ˆç‚¹å…³æ³¨ï¼Œå†åˆ·ç¤¼ç‰©ï¼","ç…®è±†ç‡ƒè±†èï¼Œè±†åœ¨é‡œä¸­æ³£ï¼Œéƒ½æ˜¯æŠ¢é±¼ä¸¸ï¼Œç›¸ç…ä½•å¤ªæ€¥ï¼"
                    ];


    const royalTime = 300;//å‘é€å¼¹å¹•åæ›´æ”¹çš‡æ—çš„æ—¶é—´é—´éš”ï¼Œç½‘ç»œå»¶è¿Ÿå¤§åˆ™å¢åŠ æ­¤æ•°å€¼ ,åæ­£åˆ™å‡å° ms;
    var bombNum = 0;//è½°ç‚¸å¼¹å¹•æ•°ç»„åºå·
    var tmGap = 10000;//é»˜è®¤å¼¹å¹•æ—¶é—´é—´éš”ä¸è½®è¯¢é—´éš” ms
    var msgTxt, msgBtn, firePowerTimeout, fireJumpTimeout, bombInterval;
    var uid = "æœªçŸ¥", uname="æœªçŸ¥", roomId;//ç”¨æˆ·idï¼Œæ˜µç§°ï¼Œæˆ¿é—´å·
    var thankFlag = true;
    var sbts = (new Date()).getTime();//å½“å‰æ—¶é—´æˆ³
    var radioStorage = "ceaseFire";

    //=============================================================================
    //++++++++++++++++++++++äº‘ç«¯è·å–å¼¹å¹•ï¼Œæš‚æ—¶ä¸å¯ç”¨æœ¬åœ°ç¼“å­˜++++++++++++++++++++++++++
    //=============================================================================
    function cloudBarrage(){
        var categoryName = document.getElementsByClassName("Title-categoryItem")[1];
        categoryName = categoryName.innerText;
        fetch('https://raw.githubusercontent.com/wolf-scream/danmu_repository/master/cloud_danmu.json',{
            method: 'GET',
            mode: 'cors', //è¯·æ±‚æ¨¡å¼ä¸ºè·¨åŸŸ
            cache: 'default', //no-cache
            credentials: 'omit', // åŒæºåˆ™åŠ å…¥å‡­æ®å¤´,cookies
        }).then(res => {
            return res.json();
        }).then(json => {
            arrCommon = json.data[categoryName]!=undefined ? arrCommon.concat(json.data[categoryName]):arrCommon;
        }).catch(err => {
            console.log('è¯·æ±‚é”™è¯¯', err);
        })
    }

    //æ¨¡æ‹Ÿç‚¹å‡»é¼ æ ‡äº‹ä»¶ï¼Œå®ç°ç‰¹æ¬§çš‡å¼¹å¹•ç‰¹æ•ˆ
    function clickBtnEvent(){//roles:1:å¹»ç¥ï¼Œotherï¼šè¶…çº§çš‡å¸
        sbts = (new Date()).getTime();
        // setTimeout(function(){royalChatEffect(parseInt(Math.random()*2))}, royalTime);
        // setTimeout(function(){royalChatEffect(0)}, royalTime);
        // setTimeout(function(){screenEmpireBarrage()}, royalTime);
    }

    //è‡ªåŠ¨å¼€å¯å¼¹å¹•
    function startBarrage() {
        var probNum = parseInt(Math.random() * 7);
        if(probNum == 0){
            var num = parseInt(Math.random() * arrPoetry.length);
            console.log("ç²¾é€‰å¼¹å¹•ç¬¬<"+num+">æ¡,æ—¶é—´é—´éš”<"+((new Date()).getTime() - sbts)/1000+"s>" + arrPoetry[num]);
            msgTxt.value = arrPoetry[num];
            msgBtn.click();
            clickBtnEvent();
        }else if(probNum == 1){
            thankBarrage();
        }else{
            var num1 = parseInt(Math.random() * arrCommon.length);
            console.log("æ™®é€šå¼¹å¹•ç¬¬<"+num1+">æ¡,æ—¶é—´é—´éš”<"+((new Date()).getTime() - sbts)/1000+"s>" + arrCommon[num1]);
            msgTxt.value = arrCommon[num1];
            msgBtn.click();
            clickBtnEvent();
        }
    }

    //æ„Ÿè°¢å¼¹å¹•
    function thankBarrage(){
        var fireMaker = document.getElementsByClassName("FirePowerChatModal-roomAdminTitle")[0];
        if(fireMaker!= undefined && fireMaker.innerText.indexOf("å‘èµ·äº†ç«åŠ›å…¨å¼€") ){
            var reg = new RegExp("å‘èµ·äº†ç«åŠ›å…¨å¼€");//å»é™¤ç©ºæ ¼å’ŒæŒ‡å®šå­—æ®µ
            var makerName = fireMaker.innerText.replace(reg,"");
            makerName = thankFlag?"æ„Ÿè°¢æˆ¿ç®¡çš„ä¸¸å­ï¼Œ@"+ makerName + "ï¼šè€æ¿å¤§æ°”ï¼":"æˆ¿ç®¡å‘ä¸¸æˆ‘æ¥æŠ¢ï¼Œæˆ¿ç®¡å¼€ç«æˆ‘ä¸Šåœºï¼";
            msgTxt.value = makerName;
            console.log("æ„Ÿè°¢å¼¹å¹•ç¬¬<"+ (thankFlag?"1":"2") +">æ¡,æ—¶é—´é—´éš”<"+((new Date()).getTime() - sbts)/1000+"s>" + msgTxt.value);
            thankFlag = !thankFlag;
        }else{
            msgTxt.value = thankFlag?"PICKæˆ‘å§ï¼Œæ„Ÿè°¢ä¸»æ’­ï¼":"ä¿ºå°±å–œæ¬¢è¢«ä¸»æ’­éª—å¼¹å¹•ï¼Œè°è®©ä¿ºæ˜¯ä¸ªæ†¨æ†¨ï¼";
            console.log("æ„Ÿè°¢å¼¹å¹•ç¬¬<"+ (thankFlag?"1":"2") +">æ¡,æ—¶é—´é—´éš”<"+((new Date()).getTime() - sbts)/1000+"s>" + msgTxt.value);
            thankFlag = !thankFlag;
        }
        msgBtn.click();
        clickBtnEvent();
    }

    //ä¸­å¥–ç­”è°¢å¼¹å¹•
    function replyBarrage(){
        var awardRecord = document.querySelector(".FirePowerRewardModal-rewardList");
        if(awardRecord!=undefined){
            msgTxt.value = awardRecord.innerText.indexOf(uname)!=-1 ?(thankFlag?"å“ˆå“ˆå“ˆï¼Œä¸­äº†ï¼Œä¸­äº†ï¼ŒğŸ˜˜è€æ¿å¤§æ°”ï¼":"è°¢è°¢å¤§ä½¬ï¼Œæˆ‘å±…ç„¶ä¸­äº†ï¼Œå¥½å—¨å“Ÿï¼"):(thankFlag?"åˆæœ¨æœ‰ä¸­ï¼Œè¢«å„è¿è¯…å’’äº†ğŸ¤¢ï¼":"åˆåŒå’å•æ²¡ä¸­å‘€ï¼Œå¥½è“ç˜¦ï¼");
            console.log("ä¸­å¥–å¼¹å¹•ç¬¬<"+ (thankFlag?"1":"2") +">æ¡,æ—¶é—´é—´éš”<"+((new Date()).getTime() - sbts)/1000+"s>" + msgTxt.value);
            msgBtn.click();
            clickBtnEvent();
            document.querySelector(".FirePowerRewardModal-close")!=undefined? document.querySelector(".FirePowerRewardModal-close").click(): true; //å…³é—­ä¸­å¥–åå•
        }
    }

    //=============================================================================
    //++++++++++++++++++++++å‘é€æŠ„è¢­å¼¹å¹•ï¼Œå®¹æ˜“è¢«è¯†åˆ«ï¼Œå·²å¼ƒç”¨++++++++++++++++++++++++++
    //=============================================================================    
    function copyBarrage(){
        var barrage = "";
        if ( document.getElementsByClassName('Barrage-content').length > 2 ) {
            let barrageArr = document.getElementsByClassName('Barrage-content');
            barrage = barrageArr[barrageArr.length-2].innerText;// .replace(/\s/g, ''); replaceæ˜¯å»é™¤å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼ï¼Œåˆ¶è¡¨ï¼Œæ¢å·ç¬¦å·ï¼›
            if(escape(barrage).indexOf( "%u" )!=-1){//åˆ¤è¯»æ˜¯å¦æœ‰ä¸­æ–‡ï¼Œescapeå¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼–ç æ—¶ï¼Œå­—ç¬¦å€¼å¤§äº255çš„ä»¥"%u****"æ ¼å¼å­˜å‚¨ï¼Œå¤§äº255çš„æ°å¥½æ˜¯éè‹±æ–‡å­—ç¬¦
                msgTxt.value = thankFlag? "æ†¨æ†¨@" + barrage:barrage+" æ†¨æ†¨ï¼";
                console.log("æŠ„è¢­å¼¹å¹•ç¬¬<"+ barrageArr.length +">æ¡,æ—¶é—´é—´éš”<"+((new Date()).getTime() - sbts)/1000+"s>" + msgTxt.value);
                msgBtn.click();
                clickBtnEvent();
                thankFlag = !thankFlag;
            }else{
                randomChineseStr();
            }
        }else{
            randomChineseStr();
        }
    }

    // è¿”å›éšæœºä¸‰ä¸ªä¸­æ–‡å­—ç¬¦
    function randomChineseStr(){
        var str = "";
        for(let i=0; i < 2 + Math.floor((Math.random() * 3)); i++ ){
            var _lower = parseInt(Math.random() * 20901);
            str += String.fromCharCode(19968 + _lower);
        }
        msgTxt.value = str;
        console.log("ä¹±ç å¼¹å¹•å«<"+ str.length +">å­—,æ—¶é—´é—´éš”<"+((new Date()).getTime() - sbts)/1000+"s>" + msgTxt.value);
        msgBtn.click();
        clickBtnEvent();
    }

    //è·å–çœŸå®å­—ç¬¦ä¸²é•¿åº¦ï¼Œä¸­æ–‡2ä¸ªï¼Œè‹±æ–‡1ä¸ª
    function getRealStrLength(str){
        var realLength = 0, len = str.length, charCode = -1;
        for (var i = 0; i < len; i++) {
            charCode = str.charCodeAt(i);
            if (charCode >= 0 && charCode <= 128){
                realLength += 1;
            }else{
                realLength += 2;
            }
        }
        return realLength;
    }
    
    //=============================================================================
    //++++++++++++++++++++++å‘é€å¼¹å¹•æ—¶é—´ç®—æ³•ï¼ˆå¼¹å¹•é—´éš”æ•°ç›®ï¼‰++++++++++++++++++++++++++
    //=============================================================================
    // è·å–ä¸Šæ¬¡å¼¹å¹•çš„ä½ç½®é—´éš”
    function countBarrageGap(num){
        var gapFlag = true;
        var chatList = document.getElementsByClassName("Barrage-listItem");
        for(let i= chatList.length-1; i>-1;i--){
            let lastGap = chatList.length - i -1;
            if(chatList[i].innerHTML.indexOf("is-self")!=-1 ){
                if(lastGap>= num){
                    gapFlag = true;
                    // console.log("è·è‡ªå·±ä¸Šæ¡å¼¹å¹•ä¸ªæ•°é—´éš”==========>" + lastGap+"/"+num);
                    break;
                } else{
                    gapFlag = false;
                    console.log("è·è‡ªå·±ä¸Šæ¡å¼¹å¹•ä¸ªæ•°é—´éš”==========>" + lastGap+"/"+num);
                    break;
                }
            }
        }
        return gapFlag;
    }

    // åˆ¤æ–­å½“å‰æˆ¿é—´æ˜¯å¦ç«åŠ›å…¨å¼€,è‡ªåŠ¨ç›‘å¬
    function firePowerMsg() {
        var fireObj = document.getElementsByClassName("FirePowerChatModal-Notice")[0];
        if ( fireObj != undefined && awardJudge() && !banSpeak() ) {//å¼€ç«é™åˆ¶æ¡ä»¶==ç«åŠ›å…¨å¼€+å¥–å“ç­›é€‰+éç¦è¨€
            let num = parseInt(Math.random()*3) + 3; //éšæœºæŒ‡å®š3~5æ¡å¼¹å¹•é—´éš™åœ¨å‘é€è‡ªå·±å¼¹å¹•
            countBarrageGap(num)?startBarrage():undefined;
        } else {//å¼¹å¹•åœæ­¢
            if( (new Date()).getTime() - sbts < 1000*100){//ä¼˜åŒ–æ£€æµ‹æ„Ÿè°¢ä¸­å¥–æ¬¡æ•°
                replyBarrage();
            }
            console.log("å¼¹å¹•åœæ­¢æ—¶é—´ç´¯è®¡ï¼š"+ ((new Date()).getTime() - sbts)/1000 + "s");
        }
        randomTime();//å›è°ƒéšæœºæ—¶é—´
    }

    //éšæœºæ—¶é—´å·®
    function randomTime(){
        let tmRandom = tmGap + parseInt(Math.random()*1500);
        firePowerTimeout= setTimeout(firePowerMsg, tmRandom);
    }

    //æŠ½å¥–æˆªæ­¢å€’è®¡æ—¶
    function remainTime(){
        var timeLeft = 0;
        var restTime = document.getElementsByClassName("FirePowerChatModal-remainTime")[0];
        if(restTime != undefined){
            restTime = restTime.innerText.split(":");
            timeLeft = parseInt(restTime[0]) * 60 + parseInt(restTime[1]);
        }
        return timeLeft;
    }

    //=============================================================================
    //+++++++++++++++++++++++++++++++++å¼¹å¹•è½°ç‚¸++++++++++++++++++++++++++++++++++++
    //=============================================================================
    function bombBarrage(){
        var tmBomb; //ç‚¸å¼¹çš„è½°ç‚¸æ—¶é—´é—´éš” ms
        function mySend(){
            tmBomb = 1500 + parseInt(Math.random()*1000)
            if(bombNum<arrCommon.length){
                console.log("å¼¹å¹•è½°ç‚¸æ—¶é—´é—´éš”ï¼š"+tmBomb/1000 +"s<++++++>"+arrCommon[bombNum]);
                msgTxt.value= arrCommon[bombNum];
                msgBtn.click();
                clickBtnEvent();
                bombNum+=1;
            }else{
                bombNum = 0;
                console.log("å¼¹å¹•è½°ç‚¸æ—¶é—´é—´éš”ï¼š"+tmBomb/1000 +"s<++++++>"+arrCommon[bombNum]);
                msgTxt.value= arrCommon[bombNum];
                msgBtn.click();
                clickBtnEvent();
            }
        }
        mySend(); //ç«‹é©¬å…ˆè°ƒç”¨ä¸€æ¬¡
        bombInterval = setInterval(mySend, tmBomb);
    }

    // ç«åŠ›å…¨å¼€æˆ¿é—´å·éšæœºæœç´¢
    function randomFireRequest() {
        var ajax = new XMLHttpRequest();
        ajax.timeout = 2000;
        ajax.responseType = "json";
        ajax.open('get', 'https://www.douyu.com/japi/firepower/apinc/activeTask/getRecRid', true); //é‡‡ç”¨å¼‚æ­¥
        ajax.send();
        ajax.onreadystatechange = function() {
            if (ajax.readyState == 4 && ajax.status == 200) {
                // var jsonData = JSON.parse(ajax.responseText);
                fireRequestFilter(ajax.response.data);
            }
        }
    }

    // ç«åŠ›å…¨å¼€æˆ¿é—´æœç´¢è¿‡æ»¤
    function fireRequestFilter(fireUrl) {
        var myRequest = new Request('https://www.douyu.com/swf_api/h5room/'+fireUrl);
        fetch(myRequest).then(function(response) {
            return response.json().then(function(json) {
                var jsonData = json.data;
                console.log("ä¸»æ’­æ˜µç§°:ã€"+jsonData.nickname+"ã€‘++++++åœ¨çº¿äººæ•°:ã€" + jsonData.online + "ã€‘++++++æ¸¸æˆåç§°:ã€" + jsonData.game_name+"ã€‘++++++URL=>https://www.douyu.com/"+fireUrl);
                if (jsonData.online < 3000 && jsonData.game_name.indexOf("ä¸€èµ·çœ‹") == -1 && jsonData.game_name.indexOf("äºŒæ¬¡å…ƒ") == -1 && jsonData.game_name.indexOf("æˆ·å¤–") == -1 && jsonData.game_name.indexOf("æ±½è½¦") == -1) { //ç­›é€‰æ¡ä»¶ï¼šè¿‡æ»¤äºŒæ¬¡å…ƒã€çœ‹ç”µå½±ã€æˆ·å¤–å’Œäººæ•°>3000çš„æˆ¿é—´
                    fireUrl = "https://www.douyu.com/" + fireUrl;
                    var dailyPageCount = localStorage.getItem((new Date()).toLocaleDateString() + "ğŸ“±ğŸŒğŸ“±[" + uname + "]");
                    if (dailyPageCount != null ) {
                        dailyPageCount = parseInt(dailyPageCount) + 1;
                        localStorage.setItem((new Date()).toLocaleDateString() + "ğŸ“±ğŸŒğŸ“±[" + uname + "]", dailyPageCount);
                    } else {
                        localStorage.setItem((new Date()).toLocaleDateString() + "ğŸ“±ğŸŒğŸ“±[" + uname + "]", 1);
                    }
                    window.location.href = fireUrl;
                    // setTimeout(function(){window.location.href = fireUrl},1000);//å»¶è¿Ÿè·³è½¬ï¼Œé˜²æ­¢æœåŠ¡å™¨ä¸å“åº”
                } else {
                    randomFireRequest(); //é‡æ–°è·å–ç«åŠ›å…¨å¼€çš„roomId
                }
            });
        });
    }

    //===============================================================
    //+++++++++++++++++++++++++å¸çš‡èŠå¤©ç‰¹æ€§+++++++++++++++++++++++++++
    //===============================================================
    function royalChatEffect(roles) {//roles:1:å¹»ç¥ï¼Œotherï¼šè¶…çº§çš‡å¸
        if (document.getElementsByClassName('Barrage-listItem').length > 1) {
            let barrageArr = document.getElementsByClassName('Barrage-listItem');
            var roomFlag = false;
            for (let i = barrageArr.length - 1; i >= 0; i--) {
                if (barrageArr[i].lastElementChild != null && barrageArr[i].lastElementChild.innerHTML.indexOf("Barrage-nobleImg") == -1 && barrageArr[i].lastElementChild.innerHTML.indexOf("is-self") != -1) { //éç©ºï¼Œå»é‡ï¼Œæ‰¾è‡ªå·±

                    //å¢åŠ å•å­—è½¦é˜Ÿå›¾æ ‡,å»é‡
                    if(barrageArr[i].lastElementChild.innerHTML.indexOf("Motor")==-1){
                        var iconTag = document.createElement("span");
                        iconTag.className = "Motor"
                        iconTag.setAttribute("title","ç¥");
                        iconTag.setAttribute("data-motorcade","ç¥");
                        iconTag.setAttribute("style","background-image:url(https://img.douyucdn.cn/data/yuba/admin/2019/01/07/201901071437499042327937962.png)");
                        var iconSpan = document.createElement("span");
                        iconSpan.className = "Motor-flag";
                        iconSpan.innerText = "ç¥"
                        iconTag.appendChild(iconSpan);
                        barrageArr[i].lastElementChild.insertBefore(iconTag,barrageArr[i].lastElementChild.children[1]);
                    }

                    //ä¿®æ”¹ç”¨æˆ·ç­‰çº§ã€æˆ¿é—´ç­‰çº§å’Œå­—å¹•é¢œè‰²
                    var userLevelObj = barrageArr[i].lastElementChild.querySelector(".UserLevel");
                    if( userLevelObj!=undefined){
                        userLevelObj.className = "UserLevel UserLevel--120";
                        userLevelObj.setAttribute("title", "ç”¨æˆ·ç­‰çº§ï¼š120");
                    }
                    var roomLevelObj = barrageArr[i].lastElementChild.querySelector(".RoomLevel");
                    if( roomLevelObj!=undefined){
                        roomLevelObj.className = "RoomLevel RoomLevel--16";
                        roomLevelObj.setAttribute("title","æˆ¿é—´ç­‰çº§ï¼š16");
                    }
                    var barrageColorObj = barrageArr[i].lastElementChild.querySelector(".Barrage-content");
                    if(barrageColorObj !=undefined){
                        barrageColorObj.className = "Barrage-content Barrage-content--color0";
                    }

                    //å¦‚æœæ²¡æœ‰æˆ¿é—´ç­‰çº§åˆ™åˆ›å»ºå…ƒç´ 
                    if(roomFlag ==false){
                        var roomTag = document.createElement("span");
                        roomTag.className ="RoomLevel RoomLevel--16";
                        roomTag.setAttribute("title","æˆ¿é—´ç­‰çº§ï¼š16");
                        barrageArr[i].lastElementChild.insertBefore(roomTag,barrageArr[i].lastElementChild.children[1]);
                    }

                    // å¢åŠ ç­¾åˆ°æ‰‹æ°”ç‹
                    var fireIconObj = barrageArr[i].lastElementChild.getElementsByClassName("FirePowerIcon")[0];
                    var signTag = document.createElement("a");
                    signTag.setAttribute("class","Baby");
                    signTag.setAttribute("data-id","1500000312");
                    var signIconImg = document.createElement("img");
                    signIconImg.setAttribute("class","Baby-image  js-baby-signMedalClick");
                    signIconImg.setAttribute("src","https://res.douyucdn.cn/resource/2019/06/27/reward/15fd9177ac85d6e91414e3ea00c2d720.png");
                    signIconImg.setAttribute("title","ç­¾åˆ°æ‰‹æ°”ç‹");
                    signTag.appendChild(signIconImg);
                    if( barrageArr[i].lastElementChild.innerHTML.indexOf("Baby-image")==-1 ){//å»é‡
                        fireIconObj!=undefined? barrageArr[i].lastElementChild.insertBefore(signTag,fireIconObj): barrageArr[i].lastElementChild.appendChild(signTag);
                    }

                    //å¢åŠ çŒœç‹å›¾æ ‡,ä¸åœ¨åŒæ°´å¹³çº¿ï¼Œä¸ä¼˜é›…å»é™¤
                    // var guessTag = document.createElement("a");
                    // guessTag.className = "Medal";
                    // guessTag.setAttribute("data-id","1500000230");
                    // var guessImg = document.createElement("img");
                    // guessImg.setAttribute("class","Medal-image");
                    // guessImg.setAttribute("src","//res.douyucdn.cn//resource/2018/03/16/reward/9f192d005a697258371bef79e4550295.png");
                    // guessImg.setAttribute("title","ç«çŒœå‘¨æ¦œæ”¶ç›Šç¬¬ä¸€å");
                    // guessTag.appendChild(guessImg);
                    // barrageArr[i].lastElementChild.insertBefore(guessTag,barrageArr[i].lastElementChild.children[1]);

                    // æ·»åŠ ç²‰ä¸ç‰Œï¼Œæœªè€ƒè™‘æœ¬èº«çš„ç²‰ä¸ç‰Œå»é™¤
                    var fansMedalName = document.getElementsByClassName("FansMedal-name")[0];//ç²‰ä¸ç‰Œåç§°
                    var fansBackgroundImg = document.getElementsByClassName("FansRankList-item FansRankList-item--top")[0];
                    barrageArr[i].className = "Barrage-listItem js-floating-barrage js-fansfloating-barrage";
                    barrageArr[i].lastElementChild.className = "js-fansfloating-barragecont Barrage--paddedBarrage";
                    if(fansMedalName!=undefined && roomId!=undefined && fansBackgroundImg!= undefined ){//å½“å‰æˆ¿é—´ä¸ºæ™®é€šç²‰ä¸ç‰Œ

                        if(fansBackgroundImg.innerHTML.indexOf("background-image:")==-1){
                            var fansTag = document.createElement("div");
                            fansTag.className="FansMedal level-30 js-fans-dysclick Barrage-icon";
                            fansTag.setAttribute("data-rid",roomId);//idä¸æˆ¿é—´å·ä¸€è‡´
                            var fansSpan = document.createElement("span");
                            fansSpan.className = "FansMedal-name js-fans-dysclick";
                            fansSpan.setAttribute("data-rid",roomId);
                            fansSpan.innerHTML = fansMedalName.innerText;
                            fansTag.appendChild(fansSpan);
                            barrageArr[i].lastElementChild.insertBefore(fansTag,barrageArr[i].lastElementChild.firstElementChild);
                        }else{//å½“å‰æˆ¿é—´ä¸ºåŠ¨æ€ç²‰ä¸ç‰Œ
                            var fansTag1 = document.createElement("div");
                            fansTag1.className="FansMedal is-made js-fans-dysclick Barrage-icon";
                            fansTag1.setAttribute("style", fansBackgroundImg.getElementsByClassName("FansMedal is-made")[0].getAttribute("style") );
                            fansTag1.setAttribute("data-rid",roomId);//idä¸æˆ¿é—´å·ä¸€è‡´
                            var fansSpan1 = document.createElement("span");
                            fansSpan1.className = "FansMedal-name js-fans-dysclick";
                            fansSpan1.setAttribute("data-rid",roomId);//idä¸æˆ¿é—´å·ä¸€è‡´
                            fansSpan1.innerHTML = fansMedalName.innerText;
                            fansTag1.appendChild(fansSpan1);
                            barrageArr[i].lastElementChild.insertBefore(fansTag1,barrageArr[i].lastElementChild.firstElementChild);
                        }
                    }else{//å½“å‰æˆ¿é—´æ— ç²‰ä¸ç‰Œï¼Œåˆ™æŒ‡å®šä¸€ä¸ªç²‰ä¸ç‰Œ
                        var fansTag2 = document.createElement("div");
                        fansTag2.className="FansMedal is-made js-fans-dysclick Barrage-icon";
                        fansTag2.setAttribute("style","background-image: url('https://gfs-op.douyucdn.cn/fans_medal_resource/2019/07/12/5a5efaca4d1250413ed9c3c36438f6cb.gif')");//idä¸æˆ¿é—´å·ä¸€è‡´
                        fansTag2.setAttribute("data-rid","4615502");//idä¸æˆ¿é—´å·ä¸€è‡´
                        var fansSpan2 = document.createElement("span");
                        fansSpan2.className = "FansMedal-name js-fans-dysclick";
                        fansSpan2.setAttribute("data-rid","4615502");//idä¸æˆ¿é—´å·ä¸€è‡´
                        fansSpan2.innerHTML = "çŒªå«å›¢";
                        fansTag2.appendChild(fansSpan2);
                        barrageArr[i].lastElementChild.insertBefore(fansTag2,barrageArr[i].lastElementChild.firstElementChild);
                    }

                    //å¢åŠ è¶…çº§çš‡å¸æ ‡ç­¾ï¼Œæœªè€ƒè™‘æœ‰å…¶ä»–è´µæ—æ ‡å¿—çš„æ›¿æ¢
                    var nobleIconObj = barrageArr[i].getElementsByClassName("Barrage-icon Barrage-noble")[0];
                    if(nobleIconObj==undefined){//è´µæ—å›¾æ ‡å»é‡
                        var royalTag = document.createElement("span");
                        var royalImg = document.createElement("img");
                        royalTag.className = "Barrage-icon Barrage-noble";
                        royalImg.className = "Barrage-nobleImg";
                        var nobleImgUrl = roles == 1 ? "//res.douyucdn.cn/resource/2019/08/15/common/4e85776071ffbae2867bb9d116e9a43c.gif" : "//res.douyucdn.cn/resource/2019/08/09/common/3d994a081e5384de14e6893d1d8b94c5.gif";
                        royalImg.setAttribute("src", nobleImgUrl);
                        royalImg.setAttribute("title", roles == 1?"å¹»ç¥":"è¶…çº§çš‡å¸");
                        royalTag.appendChild(royalImg);
                        barrageArr[i].lastElementChild.insertBefore(royalTag, barrageArr[i].lastElementChild.firstElementChild);
                    }
                    break;//åŠ ä¸­æ–­æ„å‘³ç€åªä¿®æ”¹åˆšå‘é€ä¸´è¿‘çš„ä¸€æ¡å¼¹å¹•ï¼Œé¿å…å¾ªç¯å…¨éƒ¨å¼¹å¹•çš„èµ„æºæµªè´¹
                }
            }
        } else {
            console.warn("æ— å¼¹å¹•å¯æ“ä½œ");
        }
    }

    //===============================================================
    //++++++++++++++++++++++++++è¶…çº§å¸çš‡å±å¹•ç‰¹æ•ˆ++++++++++++++++++++++++++
    //===============================================================
    function screenEmpireBarrage(){
        var fatherNode = document.querySelector(".danmu-6e95c1");
        for(let i = fatherNode.children.length-1;i>=0;i--){
            if(fatherNode.children[i].className.indexOf("noble-bf13ad")==-1 && fatherNode.children[i].innerHTML.indexOf("border: 2px solid rgb(2, 255, 255)")!=-1){//å»é‡,å¸¦è“æ¡†ä¸ºè‡ªå·±
                //çˆ¶æ ‡ç­¾æ›´æ”¹
                var liStyle = fatherNode.children[i].getAttribute("style");
                let characterLength = liStyle.substring(liStyle.indexOf("translateX(-")+12,liStyle.indexOf("px); transition"));
                let transformLength = liStyle.substring(liStyle.indexOf("transform ")+10,liStyle.indexOf("s linear"));
                let screenOpacity = liStyle.substring(liStyle.indexOf("opacity:")+8,liStyle.indexOf("; z-index:"));
                var characterStyle = "opacity: "+ screenOpacity +"; z-index: 30; background: rgba(0, 0, 0, 0); top: 54px; transform: translateX(-"+ characterLength +"px); transition: transform "+ transformLength +"s linear;"
                fatherNode.children[i].className = "danmuItem-31f924 noble-bf13ad";
                fatherNode.children[i].setAttribute("style",characterStyle);

                //è´µæ—å›¾æ ‡  æœªè€ƒè™‘å»é‡æ›¿æ¢
                var nobleImgTag = document.createElement("img");
                nobleImgTag.className = "super-noble-icon-9aacaf";
                nobleImgTag.setAttribute("src","https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/c1_51e025.png");
                nobleImgTag.setAttribute("style","margin-top: -2px;");
                fatherNode.children[i].insertBefore(nobleImgTag,fatherNode.children[i].firstElementChild);

                //ç”¨æˆ·å›¾æ ‡
                var userIconTag = document.createElement("img");
                var userIconObj = document.getElementsByClassName("Avatar is-circle")[0];//è‡ªå·±å¤´åƒ
                var fansHeader = document.getElementsByClassName("FansRankList-item FansRankList-item--top")[0];//ç²‰ä¸å¤´ç‰Œå¤´åƒ
                if(userIconObj !=undefined){
                    userIconObj = userIconObj.getElementsByTagName("img")[0].getAttribute("src");
                    userIconTag.setAttribute("src", userIconObj.replace((new RegExp("_middle")),"_small"));
                }else if(fansHeader!=undefined){//è¿™é‡Œä¸ä½¿ç”¨å›ºå®šåœ°å€å¤´åƒï¼Œé˜²æ­¢ç”¨æˆ·æ›´æ¢å¤´åƒï¼Œåœ°å€å¤±æ•ˆ
                    fansHeader = fansHeader.getElementsByTagName("img")[0].getAttribute("src");
                    userIconTag.setAttribute("src", fansHeader.replace((new RegExp("_middle")),"_small"));
                }
                userIconTag.className = "super-user-icon-574f31";
                fatherNode.children[i].insertBefore(userIconTag,fatherNode.children[i].firstElementChild);

                //å»é™¤å°¾éƒ¨æ ‡ç­¾
                var tailTag = fatherNode.children[i].getElementsByClassName("afterpic-8a2e13")[0];
                tailTag.remove();

                //æ›´æ”¹å­—å¹•å†…å®¹ç‰¹æ•ˆ
                var textContent = fatherNode.children[i].getElementsByClassName("text-879f3e")[0];
                textContent.className = "super-text-0281ca";
                textContent.setAttribute("style","font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 23px; line-height: normal; font-family: SimHei, &quot;Microsoft JhengHei&quot;, Arial, Helvetica, sans-serif; color: rgb(255, 255, 255); background: url('https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/c2_8ae118.png');");

                //å°¾éƒ¨å›¾æ ‡
                var superTailImg = document.createElement("img");
                superTailImg.className = "super-tail-bffa58";
                superTailImg.setAttribute("src","https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/c3_bfe43b.png");
                fatherNode.children[i].appendChild(superTailImg);

                //æ·»åŠ å¼€ç«æ ‡ç­¾å’Œç­¾åˆ°æ‰‹æ°”ç‹
                var afterpicTag = document.createElement("div");
                afterpicTag.setAttribute("class","afterpic-8a2e13");
                afterpicTag.setAttribute("style","margin-top: 7px; margin-left: -43px;");
                // afterpicTag.setAttribute("style","margin-top: 7px; margin-left: -1px;");
                if(document.querySelector(".FirePowerChatModal-Notice")==undefined){//æ·»åŠ æ‰‹æ°”ç‹
                    var signImgTag = document.createElement("img");
                    signImgTag.setAttribute("class","afterpic-8a2e13");
                    signImgTag.setAttribute("src","https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/lucky_c5d02e.png");
                    signImgTag.setAttribute("style","width: 28.8px; height: 28.8px;");
                    afterpicTag.appendChild(signImgTag);
                }else{//æ·»åŠ ç«å›¾æ ‡
                    var fireImg = document.createElement("img");
                    fireImg.setAttribute("class","afterpic-8a2e13");
                    fireImg.setAttribute("src","https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/hlqk_61648e.svg");
                    fireImg.setAttribute("style","width: 28.8px; height: 28.8px;");//margin-left: -42px;
                    afterpicTag.appendChild(fireImg);
                }
                fatherNode.children[i].appendChild(afterpicTag);
                // textContent.appendChild(afterpicTag);
            }
        }
    }

    //===============================================================
    //++++++++++++++++æ·»åŠ ç«åŠ›è·³è½¬æŒ‰é’®å’Œradioå¼¹å¹•çŠ¶æ€++++++++++++++++++
    //===============================================================
    function creatBtnTag(){
        // åˆ›å»ºå…ƒç´ æ ·å¼,ä¼˜å…ˆæ‰§è¡Œ,radioä¸ºå•é€‰æ¡†æ ·å¼ï¼Œdfnä¸ºtipæç¤ºçš„æ ·å¼
        var radioStyle = document.createElement('style');
        radioStyle.type = 'text/css';
        radioStyle.innerHTML = (function(){/*
        .radio{
            display: inline-block;
            position: relative;
            line-height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }
        .radio input{
            display: none;
        }
        .radio .radio-bg{
            display: inline-block;
            height: 18px;
            width: 18px;
            margin-right: 5px;
            padding:;
            background-color: #45bcb8;
            border-radius: 100%;
            vertical-align: top;
            box-shadow: 0 1px 15px rgba(0, 0, 0, 0.1) inset, 0 1px 4px rgba(0, 0, 0, 0.1) inset, 1px -1px 2px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .radio .radio-on{
            display: true;
        }
        .radio input:checked + span.radio-on{
            width: 10px;
            height: 10px;
            position: absolute;
            border-radius: 100%;
            background: #FFFFFF;
            top: 4px;
            left: 4px;
            box-shadow: 0 2px 5px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(255, 255, 255, 0.4) inset;
            background-image: linear-gradient(#ffffff 0, #e7e7e7 100%);
            transform: scale(0, 0);
            transition: all 0.2s ease;
            transform: scale(1, 1);
            display: inline-block;
        }

        dfn {
              padding: 0 0.4em;
              cursor: help;
              font-style: normal;
              position: relative;
            }
            dfn::after {
              content: attr(data-info);
              display: inline;
              white-space: pre-wrap;
              z-index: 999;
              border-radius: 4px;
              position: absolute;
              top: 22px; left: 0;
              opacity: 0;
              width: 310px;
              font-size: 13px;
              font-weight: 300;
              line-height: 1.5em;
              padding: 0.5em 0.8em;
              background: rgba(0,0,0,0.8);
              color: #fff;
              pointer-events: none;
              transition: opacity 150ms, top 150ms;
            }
            dfn::before {
              content: '';
              display: block;
              position: absolute;
              top: 12px; left: 20px;
              opacity: 0;
              width: 0; height: 0;
              border: solid transparent 5px;
              border-bottom-color: rgba(0,0,0,0.8);
              transition: opacity 150ms, top 150ms;
            }
            dfn:hover {z-index: 200;}
            dfn:hover::after,
            dfn:hover::before {opacity: 1;}
            dfn:hover::after {top: 30px;}
            dfn:hover::before {top: 20px;}
    */}).toString().split('/*')[1].split('*/')[0];
        document.head.appendChild(radioStyle);

        // åˆ›å»ºradioå…ƒç´ æ ‡ç­¾ï¼Œåäºæ ·å¼æ‰§è¡Œï¼Œæ ·å¼ç‹¬æœ‰
        var radioBtnTag = (function(){/*
        <dfn data-info="ğŸ§-æ‰‹åŠ¨ç«åŠ›å…¨å¼€æˆ¿é—´æœç´¢ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œé€‰æ‹©è·³è½¬ï¼›â›”-ç«åŠ›åœæ­¢çŠ¶æ€ï¼Œåˆå§‹åŒ–ç»„ä»¶å±•ç¤ºæ•°æ®æˆ–åœæ­¢å¼¹å¹•ï¼›ğŸ”¥-ç«åŠ›æœå¯»çŠ¶æ€ï¼Œè‡ªåŠ¨æœç´¢ç«åŠ›å…¨å¼€ç­›é€‰çš„æˆ¿é—´ï¼Œç«åŠ›åœæ­¢>60sé‡æ–°æœå¯»ï¼Œç­›é€‰æ¡ä»¶è¯¦è§è„šæœ¬æ›´æ–°æè¿°ï¼›ğŸ’¥-å¼¹å¹•è½°ç‚¸åŠŸèƒ½ï¼Œæ»¡è¶³ğŸ”¥çš„æˆ¿é—´ï¼Œåˆ‡æ¢åˆ°ğŸ’¥ä¼šè‡ªåŠ¨å‘å¼¹å¹•ï¼Œå‘é€æ—¶é—´æ ¹æ®å¼¹å¹•é—´éš”æ•°å’Œæˆ¿é—´çƒ­åº¦è®¡ç®—ï¼Œæ ¹æ®ç«åŠ›å…¨å¼€æœ‰æ— è‡ªåŠ¨å‘åœï¼Œå¼¹å¹•å†…å®¹æ ¹æ®æˆ¿é—´çš„äºŒçº§ç±»åˆ«ä»æœ¬åœ°ä¸äº‘ç«¯å¼¹å¹•åº“éšæœºæŠ½å–;">
        <label for="ceaseFire" class="radio">
            <span class="radio-bg"></span>
            <input type="radio" name="radio_fire" id="ceaseFire"  value="â›”" checked="checked"/>â›”
            <span class="radio-on"></span>
        </label>
        <label for="openFire" class="radio">
            <span class="radio-bg"></span>
            <input type="radio" name="radio_fire" id="openFire"  value="ğŸ”¥" />ğŸ”¥
            <span class="radio-on"></span>
        </label>
        <label for="bombFire" class="radio">
            <span class="radio-bg"></span>
            <input type="radio" name="radio_fire" id="bombFire"  value="ğŸ’¥" />ğŸ’¥
            <span class="radio-on"></span>
        </label>
        </dfn>
        */}).toString().split('/*')[1].split('*/')[0].replace(/[\n]/g, '');

        // åˆ›å»ºç«åŠ›å¯»æ‰¾è·³è½¬æŒ‰é’®ï¼ŒæŒ‰é’®æ ·å¼ä¾èµ–æ–—é±¼
        var fireAllBtn = document.createElement("button");
        var outSpan = document.createElement("span");
        outSpan.className = "Title-blockInline";
        fireAllBtn.innerHTML = "ğŸ§å¼€ç«";
        fireAllBtn.className = "Wallet-content-recharge"; //è¿™ä¸ªæ§åˆ¶æŒ‰é’®æ ·å¼,å¦‚Category-item, BackpackButton,PlayerToolbar-getYCBtn
        fireAllBtn.addEventListener("click", randomFireRequest);
        var blankTag = document.createElement("span");
        blankTag.innerHTML = "&nbsp;&nbsp;&nbsp;";
        var reportNode = document.querySelector(".Title-headline");//è·å–é”šç‚¹
        if(reportNode != undefined){
            outSpan.appendChild(blankTag);
            outSpan.appendChild(fireAllBtn);
            reportNode.appendChild(outSpan);
            // reportNode.parentNode.parentNode.insertBefore(outSpan,reportNode.parentNode);
        }else {
            console.error("æœªæ‰¾åˆ°ä¸¾æŠ¥å…ƒç´ èŠ‚ç‚¹ï¼Œæ— æ³•åˆ›å»ºã€ğŸ”¥ã€‘æŒ‰é’®");
        }

        //è¿™é‡Œè¦å…ˆåˆ›å»ºæ ‡ç­¾ï¼Œç„¶ååŠ¨æ€æ·»åŠ onchangeäº‹ä»¶ï¼Œå¦åˆ™è·å–ä¸åˆ°ç›‘å¬å¯¹è±¡
        var sortNode = document.querySelector(".Title-categoryWrap");//è·å–é”šç‚¹
        var seekTag = document.createElement("div");
        seekTag.className = "Title-anchorInfo";
        seekTag.innerHTML = radioBtnTag;
        if(sortNode !=undefined){
            sortNode.firstChild.append(seekTag);
            sortNode.insertBefore(seekTag,sortNode.firstElementChild.nextSibling);
            var anchor1 = document.getElementById("ceaseFire");
            anchor1.addEventListener("change",(function(){radioFunc('ceaseFire');}));
            var anchor2 = document.getElementById("openFire");
            anchor2.addEventListener("change",(function(){radioFunc('openFire');}));
            var anchor3 = document.getElementById("bombFire");
            anchor3.addEventListener("change",(function(){radioFunc('bombFire');}));
        }else{
            console.error("æœªæ‰¾åˆ°æ ‡é¢˜å…ƒç´ èŠ‚ç‚¹ï¼Œæ— æ³•åˆ›å»ºradioå•é€‰æ¡†");
        }
    }

    // localStorageæ¸…ç©ºåƒåœ¾æ•°æ®,é˜²æ–—é±¼æ”¶é›†ç”¨æˆ·ä¿¡æ¯
    function storageOperate(){
        var storage = window.localStorage;
        storage.removeItem("game_recode_listdata_h5p_room");
        for(let i = 0; i< storage.length; i++ ){//å–å‡ºè·³è½¬æ•°æ®
            if(storage.key(i).indexOf("FIRE_POWER_ACT_") != -1 || storage.key(i).indexOf("RankCoverage_vesion_") != -1 || storage.key(i).indexOf("RankCoverage_vesion_") != -1){
                storage.removeItem(storage.key(i));
            }
        }
    }

    //ç¦è¨€åˆ¤æ–­ï¼ˆtrueæ˜¯è¢«ç¦è¨€ï¼Œfalseä¸ºæ²¡æœ‰ç¦è¨€ï¼‰
    function banSpeak(){
        var banObj = document.getElementsByClassName("MuteStatus is-mute")[0];
        if(banObj!=undefined && banObj.innerHTML.indexOf("ç¦è¨€")!=-1){
            return true;
        }else{
            return false;
        }
    }

    // å‚ä¸æ¡ä»¶,æ˜¯å¦è¦æ±‚ä¸º-ç²‰ä¸å›¢æˆå‘˜  trueä¸ºç²‰ä¸ï¼Œfalseä¸ºéç²‰
    function joinCondition(){
        var joinFlag = false;
        var joinObj = document.getElementsByClassName("FirePowerChatModal-content")[0];
        if(joinObj != undefined){
            joinObj = joinObj.innerText;
            if(joinObj.indexOf("ç²‰ä¸å›¢æˆå‘˜") != -1){
                joinFlag = true;
                console.info("åªæœ‰ç²‰ä¸å›¢æ‰èƒ½å‚ä¸ï¼");
            }
        }
        return joinFlag;
    }

    // å…³æ³¨äººæ•°ç­›é€‰,å·²å»é™¤
    //var followNum = document.getElementsByClassName("Title-followNum")[0];//ä¸»æ’­è®¢é˜…

    // ä¸»æ’­çƒ­åº¦ç­›é€‰
    function hotFilter() {
        let hotFlag = true;
        let hotValue = document.getElementsByClassName("Title-anchorText")[0];//ä¸»æ’­çƒ­åº¦
        if (hotValue != undefined) {
            tmGap = 10000;
            if (hotValue.innerText <= 1000) {
                tmGap = tmGap + 5000;
            } else if(hotValue.innerText > 1000 && hotValue.innerText <= 10000 ){
                tmGap = tmGap + 2000;
            } else if(hotValue.innerText > 10000 && hotValue.innerText <= 100000){
                tmGap = tmGap ;
            } else if(hotValue.innerText > 100000 && hotValue.innerText <= 300000){
                tmGap = tmGap - 2000;
            } else if(hotValue.innerText > 300000 && hotValue.innerText <= 500000){
                tmGap = tmGap - 4000;
            } else {
                tmGap = tmGap - 6000;
                console.log("çƒ­åº¦é«˜ä¸­å¥–éš¾ï¼Œè¯·è·³è½¬ï¼");
                hotFlag = false;
            }
        }else{
            console.error("æœªè·å–åˆ°çƒ­åº¦å€¼ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼");
            // location.reload(true);
        }
        return hotFlag;
    }

    // åˆ¤æ–­å¥–å“æ˜¯å¦æ˜¯é±¼ä¸¸æˆ–çº¢åŒ…å¥–åŠ±
    function awardJudge() {
        var awardDet = document.querySelector(".FirePowerChatModal-detail");//çº¢åŒ…
        var awardStr = document.querySelector(".FirePowerChatModal-award");
        function awardConditionFilter(prizeObj){
            var awardFlag = false;
            if (prizeObj != undefined) {
                prizeObj = prizeObj.innerText;
                if(prizeObj.indexOf("é±¼ä¸¸") != -1) {
                    if(prizeObj.indexOf("1ä¸ª") == -1 && prizeObj.indexOf("2ä¸ª") == -1 && prizeObj.indexOf("1æ¡") == -1 && prizeObj.indexOf("2æ¡") == -1 &&
                       prizeObj.substring(prizeObj.indexOf("é±¼ä¸¸")-3, prizeObj.indexOf("é±¼ä¸¸")) >=100 ){
                        awardFlag = true;
                    }else{
                        console.log("é±¼ä¸¸å¥–åŠ±ä¸è¾¾æ ‡-->å†…");
                    }
                }else if (prizeObj.indexOf("çº¢åŒ…") != -1 || prizeObj.indexOf("ç°é‡‘") != -1) {
                    if(prizeObj.indexOf("0.01å…ƒ") == -1 && prizeObj.indexOf("0.1å…ƒ") == -1 && prizeObj.indexOf("0.5å…ƒ") == -1 ){
                        awardFlag = true;
                    }else{
                        console.log("çº¢åŒ…å¥–åŠ±ä¸è¾¾æ ‡-->å†…");
                    }
                }else{
                    console.log("éå®è´¨æ€§å¥–åŠ±-->ä¸­");
                }
            }else{
                // console.log( prizeObj == document.querySelector(".FirePowerChatModal-award") ? "æ— å¥–å“é”šç‚¹-->å¤–":"æ— è¯¦æƒ…é”šç‚¹-->å¤–");
            }
            return awardFlag;
        }
        return awardConditionFilter(awardStr) || awardConditionFilter(awardDet) ;
    }

    // è°ƒæ•´ç”»è´¨ï¼Œ 1.æœ€é«˜ç”»è´¨ï¼› å…¶ä»–.æœ€ä½ç”»è´¨
    function adjustClarity(code){
        var videoClarity = document.querySelector(".panelFill-d95ee8");
        if(videoClarity != undefined && videoClarity != null){
            code===1 ? videoClarity.previousSibling.firstElementChild.click() : videoClarity.previousSibling.lastElementChild.click();
        }else{
            console.log("æ²¡æœ‰ç”»è´¨ğŸ“ºé€‰é¡¹ï¼");
        }
    }

    // è®°å¿†æ»šå±å¼¹å¹•å¼€å…³
    function screenBarrageMemory(){
        var closeBarrageObj = document.getElementsByClassName("showdanmu-42b0ac")[0];
        var closeBarrageViceObj = document.getElementsByClassName("hidedanmu-5d54e2")[0];
        if(closeBarrageObj !=undefined ){
            var scrollStatus = localStorage.getItem("scrollBarrageâ°ğŸšâ°");
            if(scrollStatus == "close"){
                closeBarrageObj.click();
            }
            closeBarrageObj.addEventListener("mouseup",getScrollStatus);
            closeBarrageViceObj.addEventListener("mouseup",getScrollStatus);
        }else{
            checkDelayCallback(4);//å»¶è¿Ÿç­‰å¾…å…ƒç´ æ ‡ç­¾åŠ è½½
        }
    }

    // ç›‘å¬ç”¨æˆ·æ›´æ”¹æ»šå±å¼¹å¹•çŠ¶æ€
    function getScrollStatus(){
        var scrollBarrageObj = document.getElementsByClassName("showdanmu-42b0ac removed-9d4c42")[0];//æ»šå±å¼¹å¹•å…³é—­çŠ¶æ€
        scrollBarrageObj == undefined ? localStorage.setItem("scrollBarrageâ°ğŸšâ°","close") : localStorage.setItem("scrollBarrageâ°ğŸšâ°","open");

    }

    // è®°å¿†è‡ªåŠ¨æ’­æ”¾å¼€å…³
    function autoPlayMemory(){
        var playObj = document.getElementsByClassName("play-8dbf03")[0];
        var pauseObj = document.getElementsByClassName("pause-c594e8")[0];
        if(pauseObj!=undefined){
            var autoPlayStatus = localStorage.getItem("autoPlayStatusğŸ“€ğŸ“ºğŸ“€");
            if(autoPlayStatus == "close"){
                pauseObj.click();
            }
            playObj.addEventListener("mouseup",getAutoPlayStatus);
            pauseObj.addEventListener("mouseup",getAutoPlayStatus);
        }else{
            checkDelayCallback(3);//å»¶è¿Ÿç­‰å¾…å…ƒç´ æ ‡ç­¾åŠ è½½
        }
    }

    // ç›‘å¬ç”¨æˆ·æ›´æ”¹è‡ªåŠ¨æ’­æ”¾çŠ¶æ€
    function getAutoPlayStatus(){
        var autoPlayObj = document.getElementsByClassName("pause-c594e8 removed-9d4c42")[0];//æ’­æ”¾å™¨æš‚åœçŠ¶æ€
        autoPlayObj == undefined ? localStorage.setItem("autoPlayStatusğŸ“€ğŸ“ºğŸ“€","close") : localStorage.setItem("autoPlayStatusğŸ“€ğŸ“ºğŸ“€","open");
    }

    //è·å–ç”¨æˆ·uid,uname æ­¤æ–¹æ³•ä¸ºå¼‚æ­¥ï¼Œåˆæ¬¡è®¿é—®å¯èƒ½ä¼šå»¶è¿Ÿè·å–uname
    function getUserInfo(){
        uid = document.querySelector(".UserInfo-avatar");
        uid = uid != undefined ? uid.firstElementChild.getAttribute("uid"):"æœªçŸ¥";
        if(localStorage.getItem(uid+"ğŸŒ´ğŸ”®ğŸŒ´")!=null){//å¦‚æœç¼“å­˜æœ‰uidå’Œuname,åˆ™ä¸è¯·æ±‚ç½‘ç»œ
            uname = localStorage.getItem(uid+"ğŸŒ´ğŸ”®ğŸŒ´");
        }else{
            var ajax = new XMLHttpRequest();
            ajax.timeout = 2000;
            ajax.responseType ="document";
            ajax.open('get', 'https://www.douyu.com/member/cp',true);//é‡‡ç”¨å¼‚æ­¥
            ajax.send();
            ajax.onreadystatechange = function() {
                if (ajax.readyState == 4 && ajax.status == 200) {
                    var htmlDoc = ajax.responseXML;
                    uname = htmlDoc.querySelector(".uname_con").innerText.trim()
                    localStorage.setItem(uid+"ğŸŒ´ğŸ”®ğŸŒ´", uname);
                }
            }
        }
    }

    // è·å–å½“å‰æˆ¿é—´çš„roomId
    function getRoomId(){
        roomId = document.getElementsByClassName("Title-anchorName")[0];
        roomId = roomId!=undefined ? roomId.getAttribute("href").substr(roomId.getAttribute("href").indexOf("room_id=")+8):undefined;
    }

   // æ˜¾ç¤ºå½“å‰ç›´æ’­é—´ä¸»æ’­ä¿¡ç”¨ï¼ŒçœŸå®äººæ•°ï¼Œå’Œç´¯è®¡å¼€æ’­æ—¶é—´åœ¨æˆ¿é—´çƒ­åº¦å›¾æ ‡å·¦ä¾§
    function realPersonNum(){
        var dailyJumpCount = localStorage.getItem((new Date()).toLocaleDateString() + "ğŸ“±ğŸŒğŸ“±[" + uname + "]");
        dailyJumpCount = dailyJumpCount!=null?dailyJumpCount:0;
        var showPosition = document.querySelector(".Title-anchorHot");
        var divTag = document.createElement("div");
        divTag.className = "Title-anchorName";
        divTag.innerHTML = "<dfn id = 'real_person_num' data-info='ç‚¹å‡»æ­¤åŒºåŸŸå¯ä»¥æ›´æ–°ä»¥ä¸‹å››ç»„æ•°æ®ï¼Œå›¾æ ‡è¯´æ˜å¦‚ä¸‹ï¼š ğŸŒ-ä»Šæ—¥è·³è½¬æ¬¡æ•°(ä»…ç»Ÿè®¡ç”¨æ­¤è„šæœ¬è‡ªåŠ¨æˆ–æ‰‹åŠ¨è·³è½¬)ï¼› ğŸ’-ä¸»æ’­å½“å‰ä¿¡ç”¨å€¼(è‹¥<=4åˆ™ä¸èƒ½é€ç¤¼ç‰©,æ»¡å€¼12)ï¼› ğŸ…-å½“å‰æˆ¿é—´åœ¨çº¿äººæ•°(æœªå¼€æ’­æˆ¿é—´åˆ™ä¸º0æœªç»Ÿè®¡)ï¼› â°-æˆ¿é—´æœ¬æ¬¡å¼€æ’­æ—¶é—´ç´¯è®¡/min(æœªå¼€æ’­åˆ™ä¸ºã€-ã€‘);'> ğŸŒ- ğŸ’- ğŸ…- â°- </dfn>";//æ˜¾ç¤ºå½“å‰è·³è½¬æ¬¡æ•°ï¼Œä¸»æ’­ä¿¡ç”¨ï¼ŒçœŸå®äººæ•°ï¼Œå’Œç´¯è®¡å¼€æ’­æ—¶é—´
        showPosition.parentNode.insertBefore(divTag, showPosition);
        realPersonNumRefresh();//æ›´æ–°æ•°æ®ï¼›
        divTag.addEventListener("click",realPersonNumRefresh);
    }
    
    //è‡ªåŠ¨åˆ·æ–°çœŸå®äººæ•°
    function realPersonNumRefresh(){
        var dailyJumpCount = localStorage.getItem((new Date()).toLocaleDateString() + "ğŸ“±ğŸŒğŸ“±[" + uname + "]");
        dailyJumpCount = dailyJumpCount!=null?dailyJumpCount:0;
        fetch('https://www.douyu.com/swf_api/h5room/'+ roomId).then(res => {
            return res.json();
        }).then(json => {
            var personNum = json.data.online;
            var curCredit = json.data.cur_credit;
            var liveStatus = json.data.show_status;
            var liveTime = json.data.show_time;
            // var barrageDelay = jsonData.data.room_dm_delay;
            var onlineTime = 0;
            if(liveStatus == "1"){//å¼€æ’­
                onlineTime = ((Math.round((new Date()).getTime()/1000) - parseInt(liveTime))/60).toFixed(1);// æ˜¾ç¤ºæˆ¿é—´å·²ç»ç›´æ’­çš„åˆ†é’Ÿæ•°,ä¿ç•™ä¸€ä½å°æ•°ï¼Œæ¥æ˜¾ç¤ºç§’
            }else{
                onlineTime = "-"
            }
            var peopleObj = document.getElementById("real_person_num");
            if(peopleObj!=undefined){
                peopleObj.innerHTML = "ğŸŒ"+dailyJumpCount +"&nbsp;ğŸ’"+curCredit +"&nbsp;ğŸ…"+ personNum + "&nbsp;â°" + onlineTime + "&nbsp;";
            }
        }).catch(err => {
            console.log('è¯·æ±‚é”™è¯¯', err);
        })
    }

    //ä¸ç»‘å®šæ‰‹æœºå·å‘å¼¹å¹•(å‰ææ˜¯å¿…é¡»æ˜¯å…¶ä»–è´¦å·ç™»é™†çŠ¶æ€ï¼Œéç™»é™†çŠ¶æ€ä¸è¡Œ)
    function releasePhoneLimit(){
        var btnGray = document.getElementsByClassName("ChatSend-button is-gray")[0];
        var chatLogin = document.getElementsByClassName("MuteStatus is-noLogin")[0];
        btnGray!=undefined ? btnGray.className = "ChatSend-button ":false;
        chatLogin!=undefined ? chatLogin.remove():false;
    }

    // å‚ä¸æ¡ä»¶å…³æ³¨ï¼Œåˆ™è‡ªåŠ¨ç‚¹å‡»å…³æ³¨   #å…³æ³¨  #å–å…³
    function followRoom() {
        var subObj = document.querySelector(".Title-followBtn");
        if (subObj != undefined) {
            subObj.click();
            console.log("å·²ç»å…³æ³¨ğŸ’“ä¸»æ’­");
            setTimeout(autoAssign, 1000);//æˆ¿é—´å»¶æ—¶ç­¾åˆ°
        }
    }

    // æˆ¿é—´è‡ªåŠ¨ç­¾åˆ°
    function autoAssign(){
        var anchorLevel = (document.getElementsByClassName("AnchorLevel")[0]).getAttribute("class").substring(24);
        var unassignObj = document.getElementsByClassName("RoomLevelDetail-icon RoomLevelDetail-icon--zn")[0];//æœªç­¾åˆ°æŒ‰é’®
        var followCheck = document.getElementsByClassName("Title-followBtnBox is-followed")[0];//å·²å…³æ³¨æ£€æµ‹
        if(anchorLevel>=30 && followCheck!=undefined){//æ’é™¤å·²ç­¾åˆ°
            if(unassignObj!=undefined){
                unassignObj.click();
                console.log("æˆ¿é—´å·²ç»ğŸ“ç­¾åˆ°ï¼");
            }else{
                checkDelayCallback(5);
            }
        }
    }

    //æˆ¿é—´ç­¾åˆ°æ’è¡Œæ˜¾ç¤º
    function assignRank(){
        var anchorLevel = (document.getElementsByClassName("AnchorLevel")[0]).getAttribute("class").substring(24);
        var showPlace = document.querySelector(".Title-anchorHot");
        // è·å–å½“å‰æˆ¿é—´ç­¾åˆ°çš„æ’å
        if(anchorLevel>=30){//ä¸æ’é™¤å·²ç­¾åˆ°ï¼Œå› ä¸ºè¿˜éœ€è¦æ‰‹åŠ¨åˆ·æ–°
            var refreshTag = document.createElement("dfn");
            refreshTag.setAttribute("id","assign_Rank");
            refreshTag.setAttribute("class","Title-anchorName");
            refreshTag.setAttribute("data-info","ğŸ“-è¡¨ç¤ºå½“å‰æˆ¿é—´å·²ç­¾åˆ°äººæ•°ï¼Œç‚¹å‡»å¯ä»¥åˆ·æ–°ï¼Œæ–¹ä¾¿å¤§å®¶æ¥æŠ¢ç­¾åˆ°æ‰‹æ°”ç‹ï¼Œå¦‚æœä¸»æ’­ç­‰çº§<Lv30æ— æˆ¿é—´ç­¾åˆ°ï¼Œåˆ™æ— æ­¤å›¾æ ‡ï¼Œå¯ç»Ÿè®¡å‰100çš„æ’åï¼Œéœ€è¦æ³¨æ„å½“å¤„äºâ›”åœç«çŠ¶æ€æ‰èƒ½æ‰‹åŠ¨ç­¾åˆ°ï¼Œå…¶ä»–çŠ¶æ€ä»æ˜¯è‡ªåŠ¨ç­¾åˆ°;");
            refreshTag.innerHTML= "ğŸ“-";
            showPlace.parentNode.insertBefore(refreshTag, showPlace);
            assignRefresh();
            refreshTag.addEventListener("click",assignRefresh);
        }
    }

    //ç­¾åˆ°æ’è¡Œè‡ªåŠ¨åˆ·æ–°
    function assignRefresh(){
        fetch('https://www.douyu.com/japi/roomuserlevel/apinc/getSignInRankInfoList?rid='+roomId).then(res => {
            return res.json();
        }).then(json => {
            var jsonData = json.data;
            var assignId = document.getElementById("assign_Rank");
            assignId.innerHTML = jsonData.length <100? "ğŸ“"+jsonData.length:"ğŸ“100+";
            console.log("ğŸ“æˆ¿é—´ç­¾åˆ°äººæ•°:"+jsonData.length);
        }).catch(err => {
            console.error('è¯·æ±‚é”™è¯¯', err);
        })
    }

    // æ–—é±¼å¹³å°ç¤¼ç‰©å±•ç¤º     éœ€è¦ç”¨åˆ°postMessageé¡µé¢ä¼ å€¼gift_json
    function giftView(){
        var giftDataLength = localStorage.getItem("giftDatağŸ’–ğŸğŸ’–");
        var dailyPageCount = localStorage.getItem((new Date()).toLocaleDateString() + "ğŸ“±ğŸŒğŸ“±[" + uname + "]");
        var showPlace = document.querySelector(".Title-anchorHot");
        var giftTag = document.createElement("dfn");
        giftTag.setAttribute("class","Title-anchorName");
        giftTag.setAttribute("data-info","ğŸ-è¡¨ç¤ºå¹³å°ç¤¼ç‰©ç§ç±»æ€»é‡ï¼Œç‚¹å‡»å¯æŸ¥çœ‹ç¤¼ç‰©å›¾ç‰‡ï¼Œæ•°æ®ç»Ÿè®¡æ¯å¤©è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ï¼Œå›¾ç‰‡åˆ™ä¸æœåŠ¡ç«¯å®æ—¶åŒæ­¥;");
        if( dailyPageCount!=null && giftDataLength!=null ){
            giftTag.innerHTML="<a href='https://wolf-scream.github.io/gift_effect' target='_blank' style='text-decoration:none;'>ğŸ"+giftDataLength+"</a>";
        }else{
            //è·å–æ‰€æœ‰ç¤¼ç‰©å›¾ç‰‡url,å¹¶å±•ç¤º
            fetch('https://webconf.douyucdn.cn/resource/common/gift/flash/gift_effect.json').then(res => {
                return res.text();
            }).then(result => {
                result = result.substring(17, result.length-2);
                var jsonData = JSON.parse(result);
                jsonData=jsonData.data.flashConfig;
                var jsonLength=0;
                for(let key in jsonData){
                  jsonLength++;
                }
                localStorage.setItem("giftDatağŸ’–ğŸğŸ’–",jsonLength);
                // localStorage.setItem("giftDataLengthğŸ’–ğŸğŸ’–",jsonLength);
                giftTag.innerHTML="<a href='https://wolf-scream.github.io/gift_effect' target='_blank' style='text-decoration:none;'>ğŸ"+jsonLength+"</a>";
            }).catch(err => {
                console.error('è¯·æ±‚é”™è¯¯', err);
            })
        }
        showPlace.parentNode.insertBefore(giftTag, showPlace);
    }

    //æŠ“æ•å¹»ç¥å¼¹å¹•ç‰¹æ•ˆ
    function captureDeityBarrage() {
        var chatBarrage = document.getElementById("js-barrage-list");
        //https://res.douyucdn.cn/resource/2019/08/15/common/4e85776071ffbae2867bb9d116e9a43c.gif
        if(chatBarrage.innerHTML.indexOf("/2019/08/15/common/4e85776071ffbae2867bb9d116e9a43c.gif")>-1){
            localStorage.setItem("ğŸ…ğŸ¥¦ğŸ…chatBarrageEffect",chatBarrage.innerHTML);
            localStorage.setItem("ğŸ…ğŸ¥¦ğŸ…screenBarrageEffect", document.querySelector(".danmu-6e95c1").innerHTML);
        }
    }

    // å¢åŠ ä»£ç ç»Ÿè®¡ï¼Œä¸»è¦æµ‹è¯•ä¸‹äº‘ç«¯å¼¹å¹•è®¿é—®é¢‘æ¬¡ï¼Œå¦‚æœé¢‘æ¬¡é«˜çš„è¯ï¼ŒåæœŸå¢åŠ æœ¬åœ°ç¼“å­˜
    function jsonCloudStat(){
        // var siteId = '1278051049';
        // var statJs = document.createElement('script');
        // statJs.type = 'text/javascript';
        // statJs.async = true;
        // statJs.charset = 'utf-8';
        // statJs.src = 'https://w.cnzz.com/c.php?async=1&id=' + siteId;
        // var rootJs = document.getElementsByTagName('script')[0];
        // rootJs.parentNode.insertBefore(statJs, rootJs);
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?c641fa6f37689d8509da89529935d70c";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }

    // é‡æ–°ç‚¹å‡»radioçš„è·³è½¬å¤„ç†
    function openFireStatus(){
        var fireCheck = document.querySelector(".FirePowerChatModal-Notice");//æ£€æµ‹ç«åŠ›å…¨å¼€
        if( fireCheck != undefined && hotFilter() && awardJudge() && !banSpeak() ){ //åˆ¤æ–­å¥–å“ã€çƒ­åº¦æ•°é‡å’Œæ˜¯å¦è¦æ±‚ç²‰ä¸å›¢,hotFilteréœ€è¦åˆå§‹åŒ–
            followRoom();//è‡ªåŠ¨å…³æ³¨ä¸»æ’­
            firePowerMsg();//ç«‹å³æ‰§è¡Œç«åŠ›å…¨å¼€
        }else{//æœ‰ç«åŠ›ä¸ç¬¦åˆç­›é€‰
            console.log("ä¸ç¬¦åˆå¼€ç«ğŸ”¥æ¡ä»¶ï¼Œè‡ªåŠ¨è·³è½¬æ–°æˆ¿é—´ğŸ ");
            randomFireRequest();
        }
    }

    // ç›‘å¬radioçš„onchangeäº‹ä»¶
    function radioFunc(msg){
        if(msg == "ceaseFire"){//åœç«
            radioStorage = "ceaseFire";
            localStorage.setItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼",msg);
            clearTimeout(firePowerTimeout);
            clearTimeout(fireJumpTimeout);
            clearInterval(bombInterval);
            console.log("â›”åœæ­¢å¼€ç«");
        }else if(msg =="openFire"){//å¼€ç«
            radioStorage = "openFire";
            localStorage.setItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼",msg);
            clearTimeout(firePowerTimeout);
            clearTimeout(fireJumpTimeout);            
            clearInterval(bombInterval);
            openFireStatus();
        }else if(msg =="bombFire"){//è½°ç‚¸
            radioStorage = "bombFire";
            localStorage.setItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼",msg);
            clearTimeout(firePowerTimeout);
            clearTimeout(fireJumpTimeout);
            clearInterval(bombInterval);            
            bombBarrage();
            console.log("ğŸ’¥å¼¹å¹•è½°ç‚¸");
        }
    }

    //===============================================================
    //++++++++++ä¸»å‡½æ•°å…¥å£åŒºåŸŸ,æ ¹æ®å…ƒç´ åŠ è½½è¿›åº¦è‡ªåŠ¨å¼€å§‹åˆå§‹åŒ–ç¨‹åº++++++++
    //===============================================================
    function programInitCheck(){ //è‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨å‡ºç°ç«åŠ›å…¨å¼€ååˆ™æ‰§è¡Œè„šæœ¬
        radioStorage = localStorage.getItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼")!=null? localStorage.getItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼"): "ceaseFire";
        var chatCheck = document.querySelector(".ChatSend");//æ£€æµ‹èŠå¤©åŒºåŠ è½½
        if(chatCheck==undefined){
            checkDelayCallback(0);
        }else{//æ‰§è¡Œåˆå§‹åŒ–ç»„ä»¶
            sbts = (new Date()).getTime();//è®°å½•åˆå§‹åŒ–æ—¶é—´æˆ³
            msgTxt = document.querySelector(".ChatSend-txt");
            msgBtn = document.querySelector(".ChatSend-button");
            msgBtn.addEventListener("mouseup",clickBtnEvent);//ç»‘å®šé¼ æ ‡äº‹ä»¶
            document.onkeydown = function(e){e.keyCode==13?clickBtnEvent():false}//ç»‘å®šé”®ç›˜äº‹ä»¶
            creatBtnTag();//å…ˆæ·»åŠ æ‰‹åŠ¨æŒ‰é’®
            var radioNode = document.getElementById(radioStorage);
            radioNode.setAttribute("checked","checked");
            screenBarrageMemory();//è®°å¿†æ»šå±å¼¹å¹•çŠ¶æ€
            autoPlayMemory();//è®°å¿†è‡ªåŠ¨æ’­æ”¾çŠ¶æ€
            jsonCloudStat();//ç»Ÿè®¡äº‘å¼¹å¹•æ¥å£è®¿é—®é¢‘æ¬¡
            getUserInfo();//éœ€è¦å‰ç½®æ‰§è¡Œ
            getRoomId();//è·å–æˆ¿é—´çœŸå®ID
            giftView();//ç¤¼ç‰©ç§ç±»åŠ è½½
            realPersonNum();//æˆ¿é—´çœŸå®äººæ•°æ¨¡å—åŠ è½½
            setTimeout(assignRank, 1000);//æˆ¿é—´å»¶æ—¶ç­¾åˆ°,éœ€è¦roomId
            setTimeout(releasePhoneLimit,3500);//å»é™¤æ‰‹æœºç»‘å®šçš„é™åˆ¶
            hotFilter();//è·å–tmGap
            cloudBarrage();//äº‘å¼¹å¹•åŠ è½½
            autoAssign();//æˆ¿é—´è‡ªåŠ¨ç­¾åˆ°
            // setInterval(captureDeityBarrage,7000);//æŠ“æ•å¹»ç¥å¼¹å¹•ç‰¹æ•ˆï¼Œå»ºè®®ç”¨æˆ·æ‰“å¼€å¸®åšä¸»æŠ“å¹»ç¥
            sbts = (new Date()).getTime();//è®°å½•åˆå§‹åŒ–æ—¶é—´æˆ³
            checkDelayCallback(1);//ç»§ç»­å»¶è¿Ÿå›è°ƒ
        }
    }

    //å›è°ƒå»¶è¿Ÿå‡½æ•°æ£€æµ‹
    function checkDelayCallback(code){
        if(code===0){
            setTimeout(programInitCheck,1000);
        }else if(code===1){
            setTimeout(barrageInitCheck,1000);
        }else if(code===2){//æš‚æ— ç«åŠ›ç­‰å¾…
            if(((new Date()).getTime() - sbts)/1000 > 12){//è¶…è¿‡12sæ²¡æ£€æµ‹åˆ°ç«åŠ›åˆ™è‡ªåŠ¨æ‰§è¡Œä¸‹åˆ—æ“ä½œ
                if(radioStorage =="openFire"){
                    randomFireRequest();
                }else if(radioStorage =="bombFire"){
                    bombBarrage();
                }else if(radioStorage == "ceaseFire"){
                    console.log("åˆå§‹åŒ–ç«åŠ›ğŸ”¥åœæ­¢ï¼Œç­‰å¾…ç”¨æˆ·çš„æ“ä½œ");
                }
            }else{
                setTimeout(barrageInitCheck,1000);
            }
        }else if(code===3){
            if(((new Date()).getTime() - sbts)/1000 < 15){
                setTimeout(autoPlayMemory,1000);//å…³é—­è‡ªåŠ¨æ’­æ”¾ï¼Œå»¶è¿Ÿ15sç­‰å¾…å…ƒç´ æ ‡ç­¾åŠ è½½
            }
        }else if(code===4){
            if(((new Date()).getTime() - sbts)/1000 < 15){
                setTimeout(screenBarrageMemory,1000);//æ¢å¤è®°å¿†æ»šå±å¼¹å¹•ï¼Œå»¶è¿Ÿç­‰å¾…15så…ƒç´ æ ‡ç­¾åŠ è½½
            }
        }else if(code===5){
            if(((new Date()).getTime() - sbts)/1000 < 15){
                setTimeout(autoAssign,1000);//æ¢å¤è®°å¿†æ»šå±å¼¹å¹•ï¼Œå»¶è¿Ÿç­‰å¾…15så…ƒç´ æ ‡ç­¾åŠ è½½
            }
        }
    }

    //å¼¹å¹•ç»„ä»¶åˆå§‹åŒ–æ£€æµ‹
    function barrageInitCheck(){
        var fireCheck = document.querySelector(".FirePowerChatModal-Notice");//æ£€æµ‹ç«åŠ›å…¨å¼€
        if(fireCheck!=undefined){//æœ‰ç«åŠ›å…¨å¼€
            if(hotFilter() && awardJudge() && !joinCondition() && !banSpeak() && radioStorage=="openFire"){ //åˆ¤æ–­å¥–å“ã€çƒ­åº¦æ•°é‡å’Œæ˜¯å¦è¦æ±‚ç²‰ä¸å›¢,hotFilteréœ€è¦åˆå§‹åŒ–
                console.log("ç¬¦åˆå¼€ç«ğŸ”¥æ¡ä»¶ï¼Œåˆå§‹åŒ–å‡†å¤‡å¼€ç«");
                followRoom();//è‡ªåŠ¨å…³æ³¨ä¸»æ’­å¹¶æˆ¿é—´ç­¾åˆ°
                // adjustClarity(0);//è°ƒæ•´ç”»è´¨ï¼Œ0.ç”»è´¨æœ€ä½,1.ç”»è´¨æœ€é«˜
                firePowerMsg();//ç«‹å³æ‰§è¡Œç«åŠ›å…¨å¼€
                setTimeout(storageOperate, 10000);//è‡ªåŠ¨æ¸…ç†localStorage
            }else{//æœ‰ç«åŠ›ç­‰å¾…
                if(radioStorage == "openFire"){
                    console.log("ä¸ç¬¦åˆå¼€ç«ğŸ”¥æ¡ä»¶ï¼Œ4ç§’åè‡ªåŠ¨è·³è½¬æ–°æˆ¿é—´ğŸ ");
                    fireJumpTimeout = setTimeout(randomFireRequest,4000);
                }else if(radioStorage == "bombFire"){
                    bombBarrage();
                }else{
                    console.log("åˆå§‹åŒ–ç«åŠ›ğŸ”¥åœæ­¢ï¼Œç­‰å¾…ç”¨æˆ·çš„æ“ä½œ");
                }
            }
        }else{//æ— ç«åŠ›å…¨å¼€ï¼Œé™æ—¶ç­‰å¾…
            checkDelayCallback(2);
        }
    }

    setTimeout(programInitCheck, 4000); //4SåæŒ‰é¡µé¢åŠ è½½è¿›åº¦è‡ªåŠ¨è®¾å®šæ‰§è¡Œè„šæœ¬åˆå§‹åŒ–åŠ è½½æ—¶é—´

})();
